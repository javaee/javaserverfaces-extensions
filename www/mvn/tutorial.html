<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>JavaServer Faces Technology Extensions - 
		Project Dynamic Faces Tutorial</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <div id="banner">
                  <a href="http://java.sun.com/" id="bannerLeft">
    
                                            <img src="images/corpweb-power.gif" alt="" />
    
            </a>
                        <a href="http://java.sun.com/javaee/downloads/" id="bannerRight">
    
                                            <img src="images/javaeesdkdownload.gif" alt="" />
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
            <div class="xleft">
        Last Published: 2007 11 08
                      </div>
            <div class="xright">      <a href="http://wiki.java.net/bin/view/Projects/JsfExtensionsFaq">FAQ</a>
          |
          <a href="http://java.sun.com/javaee/javaserverfaces/">JSF</a>
          |
          <a href="http://javaserverfaces.dev.java.net/">Sun JSF</a>
          |
          <a href="http://java.sun.com/javaee/downloads/index.jsp">Java EE</a>
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
                   <h5>JSF Extensions</h5>
        <ul>
              
    <li class="none">
              <a href="index.html">home</a>
        </li>
              
    <li class="none">
              <a href="http://wiki.java.net/bin/view/Projects/JsfExtensionsFaq">FAQ</a>
        </li>
              
    <li class="none">
              <a href="http://jsf-extensions.dev.java.net/servlets/ProjectMembershipRequest">Join Project</a>
        </li>
              
    <li class="none">
              <a href="http://jsf-extensions.dev.java.net/servlets/WatchProject">Watch Project</a>
        </li>
              
    <li class="none">
              <a href="http://jsf-extensions.dev.java.net/servlets/ProjectDocumentList">Download</a>
        </li>
              
    <li class="none">
              <a href="http://jsf-extensions.dev.java.net/servlets/ProjectIssues">Issue Tracking</a>
        </li>
              
    <li class="none">
              <a href="http://jsf-extensions.dev.java.net/source/browse/jsf-extensions/">Version Control - SCM</a>
        </li>
              
    <li class="none">
              <a href="http://wiki.java.net/bin/view/Projects/JsfExtensionsFaq#How_do_I_Build_It_">Building</a>
        </li>
              
    <li class="none">
              <a href="http://wiki.java.net/bin/view/Projects/Jsf-extensions">Wiki</a>
        </li>
              
    <li class="none">
              <a href="http://jsf-extensions.dev.java.net/servlets/ProjectNewsList">Announcements</a>
        </li>
              
    <li class="none">
              <a href="http://jsf-extensions.dev.java.net/servlets/ProjectMailingListList">Mailing Lists</a>
        </li>
              
    <li class="none">
              <a href="slides.html">Slides and Screencasts</a>
        </li>
          </ul>
          <h5>Runtime Features</h5>
        <ul>
              
          
              
      
            
      
            
      
            
      
            
      
              
        <li class="expanded">
              <a href="features-ajax.html">Ajax</a>
                <ul>
                  
    <li class="none">
              <a href="features-ajax.html">Overview</a>
        </li>
                  
    <li class="none">
              <a href="gettingstarted-ajax.html">Getting Started</a>
        </li>
                  
    <li class="none">
              <a href="reference-ajax.html">Reference</a>
        </li>
                  
    <li class="none">
              <a href="ajax/apidocs/index.html">JavaDoc</a>
        </li>
                  
    <li class="none">
              <a href="ajax/tlddocs/index.html">TagLibraryDoc</a>
        </li>
              </ul>
        </li>
              
    <li class="none">
              <a href="features-flash.html">Flash</a>
        </li>
              
    <li class="none">
              <a href="features-zdt.html">Zero Deployment Time</a>
        </li>
          </ul>
          <h5>Test Time Features</h5>
        <ul>
              
    <li class="none">
              <a href="features-test.html">Test</a>
        </li>
          </ul>
          <h5>Project Documentation</h5>
        <ul>
              
                
              
      
            
      
              
        <li class="collapsed">
              <a href="project-info.html">Project Information</a>
              </li>
          </ul>
                                       <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy">
            <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
          </a>
                       
  

  
    
  
  
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        

	

	

<p>This tutorial shows you how to use Project Dynamic Faces to
add Ajax capabilities to JavaServer Faces components.</p>

<a name="Contents"></a><div class="section"><h2>Contents</h2>

<p></p>
      <ul>
        <li>
          <a href="#gevzi">Introduction to Project Dynamic Faces</a>
        </li>
        <li>
          <a href="#gelej">Understanding How Dynamic Faces Works</a>
        </li>
        <li>
          <a href="#gelae">Setting Up Your Application to Use Project Dynamic Faces</a>
        </li>
        <li>
          <a href="#gelqj">The tutorial Example</a>
        </li>
        <li>
          <a href="#gelan">Updating Single Components Using the fireAjaxTransaction Function</a>
        </li>
        <li>
          <a href="#gelba">Updating Individual DOM Elements Using installDeferredAjaxTransaction</a>
        </li>
        <li>
          <a href="#gelav">Updating Areas of Your Page Using the ajaxZone Tag</a>
        </li>
      </ul>
</div>
      <a name="gevzi"></a>
      <a name="Introduction to Project Dynamic Faces"></a><div class="section"><h2>Introduction to Project Dynamic Faces</h2>

      <p>Project Dynamic Faces allows you to add Ajax functionality to
any of the JavaServer Faces UI components that you already use. You don't need to
modify components or rewrite any of your application code to give your
applications the benefits of Ajax. Neither do you need to write extra JavaScript code
in most cases, because Dynamic Faces provides its own set of JavaScript
libraries that implement the Ajax functionality for you. At the same time, Dynamic
Faces ensures that the powerful component model and specialized life cycle that are
unique to JavaServer Faces technology continue to work as expected.</p>
</div>

      <a name="gelej"></a>
      <a name="Understanding How Dynamic Faces Works"></a><div class="section"><h2>Understanding How Dynamic Faces Works</h2>

      <p>The purpose of Ajax is to allow you to asynchronously
update only part of a page in response to user-initiated events rather
than expect the user to wait for a full-page refresh. The way Dynamic Faces
achieves this while allowing you to take advantage of the JavaServer
Faces component model and life cycle is by providing the following features:</p>
      <ul>
        <li>
          A custom JSP tag, called <code>ajaxZone</code>, which you use
to identify the parts of the component tree that you want the Ajax
functionality to update. 
        </li>
        <li>
          A set of JavaScript functions that apply the Ajax
functionality to the components you identify, send Ajax requests to the
server, and update the DOM tree on the client with the Ajax response
from the server. You can also use some of these functions directly on
the components for finer-grained control over how individual components
experience asynchronous updates. 
        </li>
        <li>
          A set of APIs that define the server-side objects that
process the Ajax request, traverse the sub-trees of components that
need to be asynchronously updated during the proper phases of the life
cycle, and construct and return Ajax responses to the client.
        </li>
      </ul>
      <p>The more commonly used JavaScript functions supplied by
Dynamic Faces include:</p>
      <ul>
        <li>
          <code>fireAjaxTransaction</code>: When invoked, this function
initiates an Ajax request with a set of options indicating which
components should experience asynchronous updates.
        </li>
        <li>
          <code>installDeferredAjaxTransaction</code>: Installs a <code>fireAjaxTransaction</code>
function onto a DOM element. The invocation of the <code>fireAjaxTransaction</code>
is deferred, meaning that it is invoked only when a certain
user-initiated event occurs.
        </li>
        <li>
          <code>inspectElement</code>: Goes through elements demarcated
by an <code>ajaxZone</code> tag and identifies which ones should exhibit
Ajax behavior. By default, it will add Ajax behavior to input and
option elements.
        </li>
      </ul>
      <p>The most important server-side objects that take part in
handling an Ajax request
and constructing and serving an Ajax response include:</p>
      <ul>
        <li>
          <code>PartialTraversalViewRoot</code>: A custom <code>ViewRoot</code>
implementation that represents one part of a component tree that needs
to be asynchronously processed or rendered.
        </li>
        <li>
          <code>PartialTraversalLifecycle</code>: A custom <code>Lifecycle</code>
implementation that assists the custom <code>ViewRoot</code>
implementation to render the appropriate sub-trees of components at the
correct time.
        </li>
        <li>
          <code>AsyncResponse</code>: Handles the formatted XML response
that represents the partial update of the component tree.
        </li>
      </ul>
      <p>The following example shows a simple use case of the <code>ajaxZone</code>
tag on a JSP page:</p>
      <pre>
...
   &lt;jsfExt:ajaxZone id=&quot;zone1&quot; execute=&quot;zone1&quot; render=&quot;zone2&quot;&gt;
   	&lt;h:selectOneMenu id=&quot;country&quot; value=&quot;#{ApplicationBean.country}&quot;
        valueChangeListener=&quot;#{ApplicationBean.updateCapital}&quot;&gt;
        &lt;f:selectItems value=&quot;#{ApplicationBean.countries}&quot;/&gt;
    	&lt;/h:selectOneMenu&gt;
   &lt;/jsfExt:ajaxZone&gt;
   &lt;jsfExt:ajaxZone id=&quot;zone2&quot;&gt;
   	&lt;h:outputtext id=&quot;capital&quot; value=&quot;#{ApplicationBean.stateCapital}&quot;/&gt;
   &lt;/jsfExt:ajaxZone&gt;
...
     </pre>
      <p>The page contains two zones demarcated by <code>ajaxZone</code>
tags. These zones are identified as <code>zone1</code> and <code>zone2</code>. The first zone includes a <code>selectOneMenu</code>
component with the ID <code>country</code>. The other zone includes an output component
with the ID <code>capital</code>. Assuming you have a managed bean called <code>ApplicationBean</code> that defines
the required properties and handler method, this example allows a user to select a country from
the <code>country</code> component and see the capital of that country asynchronously render in
the <code>capital</code> output component on the page. </p>
      <p>Notice that <code>zone1</code> includes <code>execute</code> and <code>render</code>
attributes. These attributes refer to
groups of phases in the life cycle, as shown by the following figure:</p>
<img src="images/lifecycle.gif" alt="The JavaServer Faces Life Cycle" height="384" width="600"></img>
      <p>The execute part of the life cycle is executed during a
postback.
It includes the phases that handle data conversion, validation, and
updating of the model
object. The render portion, as its name suggests, renders the page as
a result of a request for the page. For more information on
the JavaServer Faces life cycle, please see 
<a href="http://java.sun.com/javaee/5/docs/tutorial/doc/index.html">The
Life Cycle of a JavaServer Faces Page</a> in Chapter 9 of the
Java EE 5 Tutorial. </p>
      <p>The <code>execute</code> attribute of the <code>zone1</code> tag is
set to <code>zone1</code>, which means that
the components in this zone must be traversed during the execute
portion of the JavaServer Faces life cycle. The <code>country</code> menu component,
which is included in <code>zone1</code>,
must go through the execute phases because it has a value-change event
registered on it, and the handler for this event needs to update the model
value of the <code>capital</code> output component. Therefore, it needs to
go through the update model values phase of the life cycle.</p>
      <p>The <code>render</code> attribute of the <code>zone1</code> tag is
set to <code>zone2</code>, which means
that the components in <code>zone2</code> must be re-rendered after the
components in
the <code>zone1</code> tag have executed. This is so the <code>capital</code>
component displays the new
capital value when the page is re-rendered.</p>
      <p>The following figure illustrates how this page is processed:</p>
      <img src="images/partialUpdate.gif" alt="Flow of an Ajax Request and Response"></img>
      <p>The following steps outline what's happening in this figure
and explain how the JavaScript functions and APIs play a part in ?Ajaxifying? the
components:</p>
      <ol type="1">
        <li>
          <b>The client makes an initial request for the page.</b>
When the client makes an initial request for the page, the server
renders the entire page, including any necessary Dynamic Faces
JavaScript code, to the client. The component tree is now represented
as a DOM tree in the browser. The <code>ajaxZone</code> tag automatically
inserts into the page some JavaScript that inspects the DOM elements
contained within the zone so that they will fire Ajax requests when
activated.
        </li>
        <li>
          <b>The user selects a country from the menu.</b> When the
user selects a country from the menu, the <code>fireAjaxTransaction</code>
function attached to the menu component is invoked. The JavaScript code
inserted into the page in step 1 now ensures that the Ajax request is
sent to the server in such a way that the life cycle can properly
perform its tasks. These tasks include restoring the state of the
current view and updating the <code>country</code> component's value with
the request data.
        </li>
        <li>
          <b>The life cycle traverses the view.</b> On the server,
the <code>PartialViewRoot</code> instance is at the root of the partial
tree of components sent with the Ajax request. In this case, the tree
contains the <code>country</code> component. Together, the <code>PartialViewRoot</code>
and <code>PartialTraversalLifecycle</code> objects guide the <code>country</code>
component through the execute phases of the life cycle so that its
handler method can update the model value of the <code>capital</code>
component.
        </li>
        <li>
          <b>The server returns an Ajax response. </b>Using the <code>AsyncResponse</code>
instance, the <code>PartialViewRoot</code> constructs an Ajax response,
which consists of some XML that contains the new value of the <code>capital</code>
component, and sends the response to the client.
        </li>
        <li>
          <b>The HTML DOM tree is updated with the Ajax response.</b>
The JavaScript functions replace the DOM element representing the
capital in the DOM tree with the data from the Ajax response.
        </li>
      </ol>
</div>

      <a name="gelae"></a>
      <a name="Setting Up Your Application to Use Project Dynamic Faces"></a><div class="section"><h2>Setting Up Your Application to Use Project Dynamic Faces</h2>

      <p>Before you can use Project Dynamic Faces with your JavaServer Faces application, you need to do three things:</p>
      <ul>
        <li>
          Initialize the <tt>FacesServlet</tt> instance with the custom <tt>Lifecycle</tt> object used to process Ajax requests.
        </li>
        <li>
          Add the required JAR files to your application.
        </li>
        <li>
          Set up your pages to use Dynamic Faces.
        </li>
      </ul>
<p>If you are using the blank applications (<tt>blank-jsp</tt> or <tt>blank-facelets</tt>)
provided by the Dynamic Faces distribution to build your application,
you do not need to perform these tasks because they are already done
for you.  The blank applications are located in the <tt>code/run-time/samples/</tt> 
directory of your workspace. <a href="#gelsg">Building and Running the Example Application</a> 
gives instructions on how to obtain and build the workspace.</p>

       <a name="gelat"></a>
      <a name="Initializing the Lifecycle Object"></a><div class="section"><h3>Initializing the Lifecycle Object</h3>

     <p>At the heart of Dynamic Faces are the custom <tt>Lifecycle</tt>
and <tt>ViewRoot</tt>
implementations. To make the JavaServer Faces technology runtime aware
of the custom <tt>Lifecycle</tt>
object, you must tell the <tt>FacesServlet</tt> instance about the
object using an initialization parameter
in your deployment descriptor: </p>
      <pre>
&lt;servlet&gt;
   &lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;
   &lt;servlet-class&gt;javax.faces.webapp.FacesServlet&lt;/servlet-class&gt;
   &lt;init-param&gt;
   	&lt;param-name&gt;javax.faces.LIFECYCLE_ID&lt;/param-name&gt;
      &lt;param-value&gt;com.sun.faces.lifecycle.PARTIAL&lt;/param-name&gt;
   &lt;/init-param&gt;
   &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;</pre>
      <p>The custom <tt>ViewRoot</tt> is automatically installed in
the system by the JavaServer Faces
runtime, so you don't need to configure it.</p>
      </div>

<a name="gelaj"></a>
      <a name="Adding the Required JAR Files to the Application"></a><div class="section"><h3>Adding the Required JAR Files to the Application</h3>

      <p>Project Dynamic Faces depends on the following JAR files to be
available in
the <tt>WEB-INF/lib</tt> directory of the web application class loader:</p>
      <ul>
        <li>
          <tt>jsf-extensions-common.jar</tt>
        </li>
        <li>
          <tt>jsf-extensions-dynamic-faces.jar</tt>
        </li>
        <li>
          <tt>jsf-extensions-flash.jar</tt>
        </li>
        <li>
          A <tt>commons-logging</tt> JAR file at version 1.1 or
later
        </li>
        <li>
          A <tt>shale-remoting</tt> JAR file at version 1.0.3 or
later
        </li>
      </ul>
      </div>

      <a name="Setting Up the Page to Use Dynamic Faces"></a><div class="section"><h3>Setting Up the Page to Use Dynamic Faces</h3>

<a name="gelbc"></a>
      <p>To use Dynamic Faces in your page, you need to declare the
Dynamic Faces tag library in the page and include the necessary scripts in
your page. You should also set the <tt>prependId</tt> of your <tt>form</tt>
tag to false for reasons explained in this section.</p>
     <ol type="1">
        <li><b>Add the following tag library definition to the top of
your JSP page:</b>
          <pre>&lt;%@ taglib prefix=&quot;jsfExt&quot; 
    uri=&quot;http://java.sun.com/jsf/extensions/dynafaces&quot; %&gt;</pre>
        </li>
        <li><b>Add the following tag inside the head tag of your page:</b>
          <pre>&lt;jsfExt:scripts /&gt;</pre>
           The <tt>scripts</tt> tag renders the <tt>&lt;script&gt;</tt> elements for the JavaScript technology files
that Dynamic Faces provides. If you are using the <tt>ajaxZone</tt>
tag, you do not need to add the scripts tag. When you include the <tt>ajaxZone</tt>
tag in a page, the necessary scripts are automatically included in the page
as well.
        </li>
        <li><b>Set the <tt>prependId</tt> attribute to false:</b>
          <pre>
&lt;f:view&gt;
   ...
   &lt;h:form prependId=&quot;false&quot; id=&quot;form&quot;&gt;
	...
   &lt;/h:form&gt;
   ...
&lt;/f:view&gt;</pre>
         By setting the <tt>prependId</tt> attribute to false, you
can refer to component IDs without prepending the form's ID. When you work with Ajax, you need to
refer to client IDs quite often. With <tt>prependId</tt> set to false,
you can simply refer directly to the client ID, thereby reducing the size of
Ajax transactions and avoiding extra typing.
        </li>
      </ol>
</div>


</div>

      <a name="gelqj"></a>
      <a name="The Tutorial Example"></a><div class="section"><h2>The Tutorial Example</h2>

      Project Dynamic Faces gives you a lot of flexibility with
respect to how you Ajax-enable your applications. You can refer to the <a href="https://jsf-extensions.dev.java.net/nonav/mvn/reference-ajax.html">Project
Dynamic Faces Reference</a> for a complete but concise reference to the various options Project Dynamic
Faces gives you. This tutorial covers the following, more common ways to use Project Dynamic
Faces:
      <ul>
        <li>
          Using the <tt>ajaxZone</tt> tag to identify groups of
components that should be asynchronously updated.
        </li>
        <li>
          Attaching the <tt>fireAjaxTransaction</tt> JavaScript
function directly onto individual components so that they will be
asynchronously updated as a result of a user-initiated event.
        </li>
        <li>
          Using the <tt>installDeferredTransaction</tt> JavaScript
function to attach <tt>fireAjaxTransaction</tt> functions onto
particular elements in the DOM tree that you want to be asynchronously
updated.
        </li>
      </ul>
      <p>This tutorial demonstrates these features with a simple
example that uses Dynamic Faces
to allow users to do the following:</p>
      <ul>
        <li>
          Select a fruit from a radio button group and instantly see
both of the following without experiencing a full-page refresh:
          <ul>
            <li>
              The varieties for that fruit appear in a menu.
            </li>
            <li>
              A description of the currently selected variety
appears.
            </li>
          </ul>
        </li>
        <li>
          Select one of the varieties from the menu to see its
description, also without experiencing a page refresh.
        </li>
      </ul>
      <p>The following figure shows a screenshot of the example:</p>
      <img src="images/fruitScreenshot.gif" alt="Screen shot of tutorial Application" height="113" width="423"></img>
      <p>If you were using plain JavaServer Faces technology without
Dynamic Faces, you would need to add a button to update the varieties menu and the variety
description, and you would have to go through a full-page refresh to do
the update. With Dynamic Faces, you can get rid of the
button and rely on the underlying infrastructure of Dynamic Faces to do
the work of updating the appropriate components using Ajax. </p>

      <a name="gelsg"></a>
      <a name="Building and Running the Example Application"></a><div class="section"><h3>Building and Running the Example Application</h3>

      <ol type="1">
        <li><b>Using <a href="http://svnbook.red-bean.com/">Subversion</a>, check out the
JSF-Extensions workspace.</b>  Instructions for checking out the source code are at 
<a href="https://jsf-extensions.dev.java.net/source/browse/jsf-extensions/">Accessing the source code repository</a>. </li>
	  <li><b>Using <a href="maven.apache.org/">Maven</a>, build the JSF-Extensions workspace.</b>
Instructions for building the workspace are under the FAQ, 
<a href="http://wiki.java.net/bin/view/Projects/JsfExtensionsFaq#How_do_I_Build_It">How do I build it?</a>. </li>
	  <li><b>Open a terminal prompt and navigate to the <tt>code/run-time/samples/tutorial/target</tt> directory of your workspace.</b>  
The <tt>target</tt> directory was created when you built the entire workspace.  It contains the tutorial example
WAR file.  You can build the example separately from the workspace by running the Maven command you used 
to build the workspace from the
<tt>code/run-time/samples/tutorial</tt> directory instead of from the top-level <tt>code</tt> directory.</li>
        <li><b>Deploy the tutorial.war file to your web server.</b>
        </li>
        <li><b>In a web browser navigate to:</b>
          <pre>http://<i>server</i>:<i>server-port</i>/tutorial/</pre>
          This page has a list of links that take you to pages
that demonstrate different Dynamic Faces Features.
        </li>
	</ol>
</div>

</div>

      <a name="gelan"></a>
      <a name="Updating Single Components Using the fireAjaxTransaction Function"></a><div class="section"><h2>Updating Single Components Using the fireAjaxTransaction Function</h2>

      One of the JavaScript functions that Dynamic Faces provides is
the <tt>fireAjaxTransaction</tt>
function. As its name suggests, it initiates an Ajax request when it is
invoked. 
      Dynamic Faces automatically attaches <tt>fireAjaxTransaction</tt>
functions on certain components within an Ajax zone.
But, you can manually attach <tt>fireAjaxTransaction</tt> functions on
individual components in the
page so that an Ajax request is initiated when the component is
activated.
As a result, this function gives you finer-grained, component-level
control over what is updated
in your page. To use the <tt>fireAjaxTransaction</tt> function with a
component, you do
the following: 
      <ol type="1">
        <li>
          Add a JavaScript event attribute, such as <tt>onclick</tt>,
to a component tag.
        </li>
        <li>
          Set the value of the attribute to the <tt>DynaFaces.fireAjaxTransaction</tt>
function.
        </li>
        <li>
          Pass a set of parameters to the function.
        </li>
      </ol>
      The <tt>fireAjaxTx.jsp</tt> page of the <tt>tutorial</tt>
application uses <tt>fireAjaxTransaction</tt> to do the following:
      <ul>
        <li>
          Asynchronously update the menu of varieties and the
variety description when the user selects a new fruit.
        </li>
        <li>
          Asynchronously update the variety description when the
user selects a different variety from the variety menu.
        </li>
      </ul>
      The following piece of <tt>fireAjaxTx.jsp</tt> shows how the
fruit and variety components use
      <tt>fireAjaxTransaction</tt> to update components using Ajax:
      <pre>
&lt;f:view&gt;
   ...
   &lt;h:form prependId=&quot;false&quot; id=&quot;form&quot;&gt;
   ...
	&lt;h:panelGrid columns=&quot;2&quot; cellpadding=&quot;4&quot;&gt;
	   &lt;h:outputText value=&quot;Select a fruit:&quot;/&gt;
         &lt;h:outputText value=&quot;Select a variety:&quot;/&gt;
	   &lt;h:selectOneRadio id=&quot;fruit&quot; value=&quot;#{fruitInfoBean.fruit}&quot;
            onclick=&quot;DynaFaces.fireAjaxTransaction(this, { execute: 'fruit'});&quot;
            valueChangeListener=&quot;#{fruitInfoBean.changeFruit}&quot;&gt;
            &lt;f:selectItems value=&quot;#{fruitInfoBean.fruits}&quot;/&gt;
         &lt;/h:selectOneRadio&gt;
         &lt;h:selectOneMenu id=&quot;variety&quot; value=&quot;#{fruitInfoBean.variety}&quot;
            onchange=&quot;DynaFaces.fireAjaxTransaction(this, { execute: 'variety' });&quot;
            valueChangeListener=&quot;#{fruitInfoBean.updateVariety}&quot;&gt;
            &lt;f:selectItems value=&quot;#{fruitInfoBean.varieties}&quot;/&gt;
         &lt;/h:selectOneMenu&gt;  
	&lt;/h:panelGrid&gt;
      &lt;h:outputText id=&quot;varietyInfo&quot; value=&quot;#{fruitInfoBean.varietyInfo}&quot; /&gt;
  &lt;/h:form&gt;
  ...
&lt;/f:view&gt;</pre>
      <p>As the preceding markup shows, the <tt>fruit</tt> component
has an <tt>onclick</tt> JavaScript event
attribute, and the <tt>variety</tt> component has an <tt>onchange</tt>
JavaScript event attribute. These attributes
are set to a <tt>fireAjaxTransaction</tt> function call. When the user
clicks one of
these components, the following happens:</p>
      <ol type="1">
        <li>
          The <tt>DynaFaces.fireAjaxTransaction</tt> function
executes, causing Dynamic Faces to initiate an Ajax request to the
server. 
        </li>
        <li>
          The server returns a special XML response that the Dynamic
Faces JavaScript library processes. 
        </li>
        <li>
          The appropriate library functions update the HTML DOM tree
with the newly rendered values. 
        </li>
      </ol>
      <p>To tell the <tt>fireAjaxTransaction</tt> function how to
produce the Ajax request, you pass
a set of parameters to it. Here is the call to <tt>fireAjaxTransaction</tt>
from the fruit component:</p>
      <pre>DynaFaces.fireAjaxTransaction(this, { execute: 'fruit'});</pre>
      <p>In the case of the preceding example, you pass two parameters
to the <tt>fireAjaxTransaction</tt> function. The <tt>this</tt>
parameter is a JavaScript reference to the
DOM element that represents the <tt>fruit</tt> component in the
rendered markup generated by
the fruit <tt>selectOneRadio</tt> tag. </p>
      <p>The other parameter is a kind of JavaScript Object known as an
associative array, in which the keys are strings and the values are
whatever
you want them to be. Each key/value pair represents an option that you
pass to the <tt>fireAjaxTransaction</tt> function. These options tell
Dynamic Faces which parts
of the component tree it needs to process and re-render using Ajax. </p>
      <p>The <a href="https://jsf-extensions.dev.java.net/nonav/mvn/reference-ajax.html#DynaFaces.fireAjaxTransaction">Dynamic
Faces JavaScript Library Reference</a> includes the complete list of
acceptable options. In this case,
the only option is <tt>execute: 'fruit'</tt>, which says that the <tt>fruit</tt>
component (and its
children, if it has any) must go through the execute portion of
the JavaServer Faces life cycle. This part of the life cycle includes
the
phases responsible for converting and validating data, updating model
values, and handling action events.</p>
      <p>On the server side, the <tt>changeFruit</tt> method of <tt>FruitInfoBean</tt>
responds to the
value-change event registered on the <tt>fruit</tt> component. This
method performs model updates of
other components in the tree, just as it does in any regular JavaServer
Faces application. Therefore, the <tt>fruit</tt> component must go
through the execute phase
of the life cycle so that these updates can occur. The following code
snippet shows the <tt>changeFruit</tt> value-change event handler
method. As you can see,
there is nothing different you have to do in this method or any
other part of your server-side code to use Dynamic Faces with your
JavaServer
Faces application:</p>
      <pre>
public void changeFruit(ValueChangeEvent e){
   String fruitValue = (String)e.getNewValue();
   String[] varieties = getFruitVarieties(fruitValue);
   setVarietyInfo(fruitMessages.getString(varieties[0]));
   setVariety(varieties[0]);
   ...
}</pre>
      <p>Another common option to pass with the <tt>fireAjaxTransaction</tt>
function is the <tt>render</tt> option,
which you use to indicate which components should be re-rendered when
the Ajax
transaction is completed. You don't need the <tt>render</tt> option in
this example because
you want all components to be re-rendered as a result of this action,
which is the default behavior. </p>
      <p>Supposing that the user selects Apple from the set of choices
in the radio button group, the following happens:</p>
      <ol type="1">
        <li>
           The <tt>fireAjaxTransaction</tt> function is called with
the options to send the <tt>fruit</tt> component through the execute
phase of the life cycle and the rest of the tree through the render
phase of the life cycle.
        </li>
        <li>
          The <tt>fruit</tt> component goes through the execute
phase of the life cycle, and the value-change event that is registered
on it is fired. The <tt>valueChangeListener</tt> attribute of the <tt>fruit</tt>
component tag references the <tt>changeFruit</tt> method, which
handles the value-change event. This step would take place in a regular
JavaServer Faces application. 
        </li>
        <li>
          The <tt>changeFruit</tt> method gets the value, Apple,
from the <tt>fruit</tt> component, which fired the event, updates the
model value of the <tt>variety</tt> menu component with the list of
apple varieties, and sets the selected value of the <tt>variety</tt>
component to Adanac. 
        </li>
        <li>
          The <tt>changeFruit</tt> method also updates the model
value <tt>varietyInfo</tt> component, which displays the description
of the selected variety. In this case, the selected variety is Adanac,
and so the description is ?Adanac: Suitable for desserts. Green and red
striped skin. Resistant to harsh winter weather.?
        </li>
        <li>
          Dynamic Faces re-renders the DOM tree, replacing the
selected DOM elements with the new values.
        </li>
      </ol>
      <p>The <tt>fireAjaxTransaction</tt> call that occurs when a user
selects a variety from the
      <tt>variety</tt> component works in a similar way. It causes the <tt>variety</tt>
component to
go through the execute phases of the life cycle. While this happens,
the
value-change event listener, <tt>updateVariety</tt> updates the <tt>varietyInfo</tt>
model value with the description that
matches the selected variety. Then Dynamic Faces re-renders the <tt>varietyInfo</tt>
component with the new
description.</p>

</div>

      <a name="gelba"></a>
      <a name="Updating Individual DOM Elements Using installDeferredAjaxTransaction"></a><div class="section"><h2>Updating Individual DOM Elements Using installDeferredAjaxTransaction</h2>

      <p>As the previous section explained, you can use <tt>fireAjaxTransaction</tt>
to asynchronously update
individual components. Although the <tt>tutorial</tt>
application uses this function in combination with a
user-initiated event, you can use the <tt>fireAjaxTransaction</tt> in
non-event-driven situations when you include
it inside the <tt>script</tt> elements in the page. In this situation,
the function
is called immediately rather than in response to a user-initiated event.</p>
      <p>The <tt>installDeferredTransaction</tt> function is an
extension of the <tt>fireAjaxTransaction</tt> function. Rather than
executing immediately,
the <tt>installDeferredTransaction</tt> function installs a <tt>fireAjaxTransaction</tt>
onto a DOM element that will be
called when a specified event occurs on that DOM element.</p>
      <p>One situation that calls for usage of <tt>installDeferredTransaction</tt>
is when you want to
install a deferred Ajax transaction on a piece of markup generated by a
component rather than on the entire component. For example, the Java
Blueprints team
provides a table scroller component that generates a set of <tt>&lt;a&gt;</tt>
tags in
which each tag points to a different set of tabular data in the
same table, thereby allowing a user to page through the data set by
clicking on a link represented by an <tt>&lt;a&gt;</tt> tag. Because
the page author
does not know when authoring the page what <tt>&lt;a&gt;</tt> tags
will be
rendered from the component, she cannot install Ajax transactions on
these elements. Instead,
she can write some JavaScript that will install deferred Ajax
transactions on these
elements during script execution time, which occurs after the <tt>&lt;a&gt;</tt>
tags are already
rendered.</p>
      <p>The <tt>tutorial</tt> application demonstrates a
simpler use case of <tt>installDeferredAjaxTransaction</tt> in which
the function
installs deferred Ajax transactions on <tt>input</tt> tags that are
rendered from a <tt>selectOneRadio</tt>
component. In this case, the application asks the user to select the
correct
option to win a prize. If the user selects the correct option, the
application displays the message, ?You are correct. Get 20% off Peaches
at Duke's
Fruit Stand. Use coupon number GTH056.? </p>
      <p>The following code from the <tt>installDeferred.jsp</tt> page
of the application shows the tag
representing the <tt>fruitQuiz</tt> component from which the user
selects the correct answer, the
      <tt>answerMessage</tt> component tag that displays the message,
and the script that installs the
deferred Ajax transaction.</p>
      <pre>
...

&lt;h:form...&gt;
   ...
   &lt;h:outputText value=&quot;Select the true statement to win a prize:&quot;/&gt;
   &lt;h:selectOneRadio id=&quot;fruitQuiz&quot; value=&quot;#{fruitInfoBean.fruitQuiz}&quot; 
      layout=&quot;pageDirection&quot; valueChangeListener=&quot;#{fruitInfoBean.gradeFruitQuiz}&quot;&gt;
      &lt;f:selectItem itemLabel=&quot;Peaches originate from China&quot; itemValue=&quot;peaches&quot;/&gt;
      &lt;f:selectItem itemLabel=&quot;Apples sink in water&quot; itemValue=&quot;apples&quot;/&gt;
   &lt;/h:selectOneRadio&gt;
   &lt;h:outputText id=&quot;answerMessage&quot; value=&quot;#{requestScope.answerMessage}&quot; /&gt;.
&lt;/h:form&gt;
...
&lt;script&gt;
   var trueValue = null;
   trueValue = document.getElementById(&quot;fruitQuiz:0&quot;);
   DynaFaces.installDeferredAjaxTransaction(trueValue, 'click',
        {execute: 'fruitQuiz', render: 'answerMessage' });
&lt;/script&gt;</pre>
      <p>When the preceding page is rendered, the first choice from the
      <tt>selectOneRadio</tt>
component will be rendered as an <tt>input</tt> tag with the ID <tt>fruitQuiz:0</tt>.
The
first choice is the correct answer, so when the user selects it, the
installed deferred Ajax transaction is fired. When this happens, the <tt>fruitQuiz</tt>
component goes
through the execute phase of the life cycle, during which time the <tt>gradeFruitQuiz</tt>
value-change event listener method executes. If the user selected the
correct value, this
method sets the model value of the <tt>answerMessage</tt> component to
the ?winning?
message:</p>
      <pre>
public void gradeFruitQuiz(ValueChangeEvent e) {
    String answer = (String)e.getNewValue();
    String answerMessage = null;
    if (answer.equals(&quot;peaches&quot;)) {
        answerMessage = 
           &quot;You are correct. Get 20% off Peaches at Duke's Fruit Stand. &quot; +
           &quot;Use coupon number GTH056.&quot;;
    }
    FacesContext.getCurrentInstance()
       .getExternalContext()
       .getRequestMap()
       .put(&quot;answerMessage&quot;, answerMessage);
}</pre>
      <p>If the user selects the false option, the <tt>fruitQuiz</tt>
component is not executed
and no message will display.</p>
</div>

      <a name="gelav"></a>
      <a name="Updating Areas of Your Page Using the ajaxZone Tag"></a><div class="section"><h2>Updating Areas of Your Page Using the ajaxZone Tag</h2>

      <p>If you have a group of one or more components that you
want to be asynchronously updated at the same time as a result of
the same user-initiated event, you wrap the component tags on the page
with the <tt>ajaxZone</tt> tag. The <tt>ajaxZone</tt> tag supports several
attributes that allow you to customize its behavior. This section gives simple examples of using the <tt>execute</tt>,
      <tt>render</tt>, and
      <tt>inspectElement</tt> attributes. Refer to the <a href="https://jsf-extensions.dev.java.net/nonav/mvn/ajax/tlddocs/index.html">Dynamic
Faces Tag Library documentation</a> for more information on the
complete set
of attributes supported by the <tt>ajaxZone</tt> tag.</p>
      <p>The following piece of a JSP page shows a simple use of
the <tt>ajaxZone</tt> tag.</p>
      <pre>
&lt;jsfExt:ajaxZone&gt;
   &lt;h:selectOneMenu id=&quot;fruit&quot; value=&quot;#{fruitBean.selectedFruit}&quot;&gt;
      valueChangeListener=&quot;#{fruitBean.updateFruit}&quot;&gt;
      &lt;f:selectItems value=&quot;#{fruitBean.fruits}&quot;/&gt;
   &lt;/h:selectOneMenu&gt;
   &lt;h:outputText id=&quot;fruitMessage&quot; value=&quot;#{fruitBean.fruitMessage}&quot;/&gt;
&lt;/jsfExt:ajaxZone&gt;</pre>
      <p>This example lets the user select an item from the menu,
causing
a message to render asynchronously to the <tt>output</tt> component
tag. Because this example does
not set any attributes on the <tt>ajaxZone</tt> tag, it will exhibit
the default
behavior, which is that all input components in the zone will execute
as
a result of an <tt>onclick</tt> event and all components in the zone
will
be asynchronously rendered as a result of the event. The <tt>updateFruit</tt>
value-change event
listener updates the model value of the <tt>fruitMessage</tt>
component so that when it is
re-rendered, the appropriate value is displayed on the page.</p>

      <a name="gelcw"></a>
      <a name="Using the ajaxZone Tag's execute and render Options"></a><div class="section"><h3>Using the ajaxZone Tag's execute and render Options</h3>

      <p>Most examples that use the <tt>ajaxZone</tt> tag will likely
have multiple zones in
one page. The way to get actions on one zone to affect the
components in other zones is to use the <tt>execute</tt> and <tt>render</tt>
options.
The <tt>zones.jsp</tt> page of the <tt>tutorial</tt>
application does the same thing as
the <tt>fireAjaxTx.jsp</tt> page, but it does it using <tt>ajaxZone</tt>
tags instead of attaching
      <tt>fireAjaxTransaction</tt> calls directly onto the components:</p>
      <pre>
&lt;h:form prependId=&quot;false&quot; id=&quot;form&quot;&gt;
   ...
   &lt;h:panelGrid columns=&quot;2&quot; cellpadding=&quot;4&quot;&gt;
      &lt;h:outputText value=&quot;Select a fruit:&quot;/&gt;
      &lt;h:outputText value=&quot;Select a variety:&quot;/&gt;
      &lt;jsfExt:ajaxZone id=&quot;zone1&quot; execute=&quot;zone1&quot; render=&quot;zone2,zone3&quot;&gt;
         &lt;h:selectOneRadio id=&quot;fruit&quot; value=&quot;#{fruitInfoBean.fruit}&quot;
            valueChangeListener=&quot;#{fruitInfoBean.changeFruit}&quot;&gt;
            &lt;f:selectItems value=&quot;#{fruitInfoBean.fruits}&quot;/&gt;
         &lt;/h:selectOneRadio&gt;
      &lt;/jsfExt:ajaxZone&gt;
      &lt;jsfExt:ajaxZone id=&quot;zone2&quot; execute=&quot;zone2&quot; render=&quot;zone3&quot;&gt;
         &lt;h:selectOneMenu id=&quot;variety&quot; value=&quot;#{fruitInfoBean.variety}&quot;
            valueChangeListener=&quot;#{fruitInfoBean.updateVariety}&quot;&gt;
            &lt;f:selectItems value=&quot;#{fruitInfoBean.varieties}&quot;/&gt;
         &lt;/h:selectOneMenu&gt;
      &lt;/jsfExt:ajaxZone&gt;
   &lt;/h:panelGrid&gt;
   &lt;jsfExt:ajaxZone id=&quot;zone3&quot;&gt;
      &lt;h:outputText id=&quot;varietyInfo&quot; value=&quot;#{fruitInfoBean.varietyInfo}&quot; /&gt;
   &lt;/jsfExt:ajaxZone&gt;
&lt;/h:form&gt;</pre>
      <p>This page has three zones demarcated using the <tt>ajaxZone</tt>
tag. The first zone,
      <tt>zone1</tt>, contains the fruit radio button group component.
The second zone, <tt>zone2</tt>, contains
the <tt>variety</tt> menu component. And the third zone, <tt>zone3</tt>,
contains the <tt>varietyInfo</tt> output
component.</p>
      <p>Notice that the <tt>zone1</tt> tag sets the execute attribute
to <tt>zone1</tt>. It also
sets the <tt>render</tt> attribute to <tt>zone2,zone3</tt>. When the
user selects a fruit from
the radio button group, the <tt>fireAjaxTransaction</tt> method
executes with the <tt>execute</tt> and <tt>render</tt> options given
by the tag. Because the <tt>execute</tt> attribute specifies <tt>zone1</tt>,
only the components
in <tt>zone1</tt> will go through the execute phases of the life
cycle. The
      <tt>render</tt> attribute specifies all three zones, and so all
three zones will re-render
when the Ajax transaction completes. </p>
      <p>As shown in the markup for <tt>zone2</tt>, when the user
selects a variety
from the <tt>variety</tt> menu, the <tt>variety</tt> component will
go through the execute phases
of the life cycle, and <tt>zone2</tt> and <tt>zone3</tt> will be
re-rendered when
the Ajax transaction completes.</p>
      <p>Of course, you can implement this example by attaching <tt>fireAjaxTransaction</tt>
calls to
the fruit and variety components, as shown in <a href="#gelan">Updating
Single Components Using the <tt>fireAjaxTransaction</tt> Function</a>.
This is because
there is only one component in each zone. If you have multiple
components
that you want to be executed or rendered as a result of the
same event then you would use <tt>ajaxZone</tt> tags.</p>
</div>

      <a name="gelik"></a>
      <a name="Using the ajaxZone Tag's inspectElement Option"></a><div class="section"><h3>Using the ajaxZone Tag's inspectElement Option</h3>

      <p>When a page containing <tt>ajaxZone</tt> tags is first
rendered, the <tt>inspectElement</tt> function executes
on all of the child elements of a zone. It identifies the elements
contained in the zone that should initiate an Ajax transaction when the
zone's
specified event occurs. By default, the <tt>inspectElement</tt>
function identifies <tt>input</tt>, <tt>option</tt>, and <tt>button</tt>
elements. To change this behavior, you can use the <tt>inspectElement</tt>
attribute of the <tt>ajaxZone</tt>
tag along with a custom <tt>inspectElement</tt> function to specify
which elements in
the zone you want to initiate an Ajax transaction as a result of
the zone's default event, which is <tt>onclick</tt>.</p>
      <p>The <tt>inspectElement.jsp</tt> page of the <tt>tutorial</tt>
example includes a button in <tt>zone2</tt>
that, when clicked, renders the <tt>fruitSale</tt> component in <tt>zone3</tt>.
The <tt>fruitSale</tt> component displays special
offers for the fruit variety that the user has selected from the <tt>variety</tt>
menu. Here are <tt>zone2</tt>, <tt>zone3</tt>, and the custom <tt>inspectElement</tt>
function from the <tt>inspectElement.jsp</tt>
page:</p>
      <pre>
...
&lt;jsfExt:ajaxZone id=&quot;zone2&quot; execute=&quot;zone2&quot; render=&quot;zone2,zone3&quot; 
   inspectElement=&quot;inspectElement&quot;&gt;
   &lt;h:selectOneMenu id=&quot;variety&quot; value=&quot;#{fruitInfoBean.variety}&quot;
      valueChangeListener=&quot;#{fruitInfoBean.updateVariety}&quot;&gt;
      &lt;f:selectItems value=&quot;#{fruitInfoBean.varieties}&quot;/&gt;
   &lt;/h:selectOneMenu&gt;
   &lt;h:commandButton id=&quot;specials&quot; value=&quot;See Special Offers&quot;
     actionListeners=&quot;#{fruitInfoBean.specialsSubmit}&quot;
     onclick=&quot;DynaFaces.fireAjaxTransaction(this,
       {execute: 'specials', render: 'fruitSale'});&quot;/&gt;
&lt;/jsfExt:ajaxZone&gt;
...
&lt;jsfExt:ajaxZone id=&quot;zone3&quot;&gt;
  ...
  &lt;h:outputText id=&quot;fruitSale&quot;
     style=&quot;color: maroon; font-family: Arial; font-weight: bold; font-size: medium&quot; 
     value=&quot;#{fruitInfoBean.fruitSaleValue}&quot;/&gt;
&lt;/jsfExt:ajaxZone&gt;
&lt;script type=&quot;text/JavaScript&quot;&gt;
&lt;!--function inspectElement(element) {
    var result=false;
    if (null != element) {
       var tagName = element.nodeName;
       if (null != tagName) {
          if (-1 != tagName.toLowerCase().substring(&quot;option&quot;)) {
                result = true;
          }
       }
    }
    return result;}--&gt;&lt;/script&gt;</pre>
      <p>As shown in the preceding markup, the <tt>zone2</tt> tag
includes an <tt>inspectElement</tt> element
that refers to the <tt>inspectElement</tt> JavaScript function at the
end of the page. This function says that only <tt>option</tt> elements from this
zone should fire Ajax transactions when the zone is activated. This is because the <tt>commandButton</tt>
component fires its own Ajax transaction, which results in different behavior, so
the <tt>input</tt> element representing this component should not be included in the list
of elements that <tt>inspectElement</tt> identifies as those that participate in
the Ajax transaction generated by events occurring in the rest of the zone.</p>
</div>

</div>



      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2007
    
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
